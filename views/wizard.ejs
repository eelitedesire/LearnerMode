<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbonoz SolarAutopilot</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
body {
    font-family: 'Inter', sans-serif;
}
   

   :root {
    /* Color system */
    --primary-color: #DEAF0B;
    --bg-color: #f5f6fa;
    --text-color: #2f3640;
    --icon-color: #636e72;
    --green: #4CAF50;
    --red: #F44336;
    --blue: #2196F3;
    --amber: #FFC107;
    --gray: #757575;
    --primary: #DEAF0B;          /* Main accent color */
    --primary-dark: #DEAF0E;     /* Darker shade of primary */
    --secondary: #38b000;        /* Success/active color */
    --warning: #ffbe0b;          /* Warning color */
    --danger: #ef476f;           /* Danger/error color */
    --info: #4361ee;             /* Info color */
    --dark: #212529;             /* Dark text/backgrounds */
    --light: #f8f9fa;            /* Light backgrounds */
    --grey-100: #f8f9fa;
    --grey-200: #e9ecef;
    --grey-300: #dee2e6;
    --grey-400: #ced4da;
    --grey-500: #adb5bd;
    --grey-600: #6c757d;
    --grey-700: #495057;
    --grey-800: #343a40;
    --grey-900: #212529;
    
    /* Special colors for energy monitoring */
    --battery-color: #38b000;    /* Green for battery */
    --solar-color: #ffbe0b;      /* Yellow for solar/PV */
    --grid-color: #ff006e;       /* Magenta for grid */
    --load-color: #3a86ff;       /* Blue for load */
    
    /* Typography */
    --font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    --font-size-base: 1rem;
    --font-weight-normal: 400;
    --font-weight-bold: 600;
    --font-weight-header: 700;
    
    /* Spacing */
    --spacer: 1rem;
    
    /* Borders & shadows */
    --border-radius: 0.5rem;
    --border-radius-sm: 0.25rem;
    --border-radius-lg: 0.75rem;
    --border-radius-pill: 50rem;
    --box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
    --box-shadow-sm: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.05);
    --box-shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.12);
    --box-shadow-inset: inset 0 1px 2px rgba(0, 0, 0, 0.075);
    
    /* Transitions */
    --transition-base: all 0.2s ease-in-out;
    --transition-fast: all 0.1s ease-in-out;
    --transition-slow: all 0.3s ease-in-out;
    
    /* Wizard specific */
    --wizard-progress-height: 8px;
    --wizard-active-color: var(--primary);
    --wizard-inactive-color: var(--grey-300);
    --wizard-hover-color: var(--grey-200);
}

   body, html {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    height: 100%;
    
   }
    /* Sidebar styles */
    .sidebar {
        width: 280px;
        height: 100vh;
        background-color: white;
        border-right: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
        transition: width 0.3s ease;
    }
   
           .logo-container {
               padding: 1.5rem;
               border-bottom: 1px solid #e5e7eb;
               display: flex;
               align-items: center;
               gap: 0.75rem;
           }
   
           .logo-icon {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    font-size: 20px;
   }
   
   .logo-text {
    margin-left: 10px;
    font-weight: bold;
    color: var(--text-color);
    font-size: 18px;
   }
   
   .logo-text .highlight {
    color: var(--primary-color);
    margin-left: 10px;
   }
   
   
   nav {
    flex-grow: 1;
   }
   
   nav ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
   }
   nav li {
    padding: 15px 20px;
    display: flex;
    align-items: center;
    color: var(--text-color);
    cursor: pointer;
    transition: background-color 0.3s;
    font-size: 18px;
   }
   
   nav li a{
    text-decoration: none;
    color: #2f3640;
    font-weight: bold;
   }
   nav li:hover {
    background-color: var(--bg-color);
   }
   
   nav li i {
    margin-right: 15px;
    color: var(--icon-color);
    font-size: 24px;
   }
   
   .bottom-options {
    padding: 20px;
    border-top: 1px solid #dcdde1;
   }
   
   .toggle-sidebar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    font-size: 16px;
   }
   
   .toggle-text {
    margin-right: 10px;
   }
   
   .toggle-switch {
    width: 50px;
    height: 25px;
    background-color: #dcdde1;
    border-radius: 12.5px;
    position: relative;
    transition: background-color 0.3s;
   }
   .toggle-switch::before {
    content: '';
    position: absolute;
    width: 21px;
    height: 21px;
    border-radius: 50%;
    background-color: white;
    top: 2px;
    left: 2px;
    transition: transform 0.3s;
   }
   
   .toggle-switch.active {
    background-color: var(--primary-color);
   }
   
   .toggle-switch.active::before {
    transform: translateX(25px);
   }
   
   .sidebar.collapsed .logo-text,
   .sidebar.collapsed .search,
   .sidebar.collapsed nav li span,
   .sidebar.collapsed .toggle-text {
    display: none;
   }
   
   .sidebar.collapsed .logo {
    justify-content: center;
   }
   
   .sidebar.collapsed nav li {
    justify-content: center;
   }
   
   .sidebar.collapsed nav li i {
    margin-right: 0;
   }
           /* Main content styles */
           .main-content {
               flex: 1;
               margin-left: 280px;
               padding: 2rem;
           }
   
           .content-header {
               margin-bottom: 2rem;
           }
   
           .content-header h2 {
               font-size: 1.875rem;
               font-weight: 700;
               color: #111827;
           }
   
           .metrics-grid {
               display: grid;
               grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
               gap: 1.5rem;
               margin-bottom: 2rem;
           }
   
           .metric-card {
               background: white;
               border-radius: 12px;
               padding: 1.5rem;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
           }
   
           .metric-title {
               font-size: 0.875rem;
               font-weight: 600;
               color: #4b5563;
               margin-bottom: 0.5rem;
           }
   
           .metric-value {
               font-size: 1.5rem;
               font-weight: 700;
               margin-bottom: 0.25rem;
           }
   
           .metric-subtitle {
               font-size: 0.875rem;
               color: #6b7280;
           }
   
           .chart-container {
               background: white;
               border-radius: 12px;
               padding: 1.5rem;
               margin-bottom: 2rem;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
           }
   
           .chart-wrapper {
               height: 400px;
               margin-top: 1rem;
           }
   
           .period-buttons {
               display: flex;
               gap: 0.75rem;
               margin-bottom: 1rem;
           }
   
           .period-btn {
               padding: 0.5rem 1rem;
               border: none;
               background-color: #e5e7eb;
               color: #4b5563;
               border-radius: 6px;
               cursor: pointer;
               font-weight: 500;
               transition: all 0.2s;
           }
   
           .period-btn:hover {
               background-color: #d1d5db;
           }
   
           .period-btn.active {
               background-color: #DEAF0B;
               color: white;
           }
   
           /* Toggle styles */
           .toggle {
               position: relative;
               display: inline-block;
               width: 44px;
               height: 24px;
           }
   
           .toggle input {
               opacity: 0;
               width: 0;
               height: 0;
           }
   
           .slider {
               position: absolute;
               cursor: pointer;
               top: 0;
               left: 0;
               right: 0;
               bottom: 0;
               background-color: #e5e7eb;
               transition: .4s;
               border-radius: 34px;
           }
   
           .slider:before {
               position: absolute;
               content: "";
               height: 16px;
               width: 16px;
               left: 4px;
               bottom: 4px;
               background-color: white;
               transition: .4s;
               border-radius: 50%;
           }
   
           input:checked + .slider {
               background-color: #DEAF0B;
           }
   
           input:checked + .slider:before {
               transform: translateX(20px);
           }
   
           /* Updated and new styles */
           .bottom-controls {
               padding: 1.5rem;
               border-top: 1px solid #e5e7eb;
           }
   
           .control-item {
               display: flex;
               justify-content: space-between;
               align-items: center;
               margin-bottom: 1rem;
           }
   
           .control-label {
               font-size: 0.875rem;
               color: #4b5563;
           }
   
           .toggle {
               position: relative;
               display: inline-block;
               width: 44px;
               height: 24px;
           }
   
           .toggle input {
               opacity: 0;
               width: 0;
               height: 0;
           }
   
           .sidebar {
    width: 280px;
    background-color: white;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    transition: width 0.3s ease;
    z-index: 10;
   }
   
   .sidebar.collapsed {
    width: 80px;
   }
   
   .logo {
    display: flex;
    align-items: center;
    padding: 20px;
   }
   
   
           input:checked + .slider {
               background-color: #DEAF0B;
           }
   
           input:checked + .slider:before {
               transform: translateX(20px);
           }
   
           .total-emissions {
               font-size: 1.25rem;
               font-weight: 600;
               margin-bottom: 1rem;
               color: #374151;
           }
   
           .summary-grid {
               display: grid;
               grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
               gap: 1rem;
               margin-bottom: 2rem;
           }
   
           .summary-item {
               background-color: white;
               border-radius: 8px;
               padding: 1rem;
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
           }
   
           .summary-label {
               font-size: 0.875rem;
               color: #6b7280;
               display: block;
               margin-bottom: 0.5rem;
           }
   
           .summary-value {
               font-size: 1.25rem;
               font-weight: 600;
           }
   
       
   
           /* Responsive styles */
           @media (max-width: 768px) {
               .sidebar {
                   width: 100%;
                   height: auto;
                   position: static;
                   border-right: none;
                   border-bottom: 1px solid #e5e7eb;
               }
   
               .main-content {
                   margin-left: 0;
               }
   
               body.collapsed-sidebar .sidebar {
                   display: none;
               }
   
               body.collapsed-sidebar .main-content {
                   margin-left: 0;
               }
   
               .metrics-grid,
               .summary-grid {
                   grid-template-columns: 1fr;
               }
   
               .period-buttons {
                   flex-wrap: wrap;
               }
   
               .period-btn {
                   flex: 1 0 calc(50% - 0.375rem);
                   margin-bottom: 0.75rem;
               }
           }

/* loading css */

.loading-overlay {
 position: fixed;
 top: 0;
 left: 0;
 width: 100%;
 height: 100%;
 background-color: #f8f9fa;
 display: flex;
 justify-content: center;
 align-items: center;
 z-index: 9999;
}

.loading-spinner {
 width: 60px;
 height: 60px;
 border: 5px solid #e0e0e0;
 border-top: 5px solid #3498db;
 border-radius: 50%;
 animation: spin 1s linear infinite;
}

@keyframes spin {
 0% { transform: rotate(0deg); }
 100% { transform: rotate(360deg); }
}

.dashboard-column {
flex-basis: calc(33.33333% - 2px);
margin-right: 2px;
margin-bottom: 2px;
}

@media only screen and (max-width: 128em) {
.dashboard-column {
 flex-basis: calc(50% - 2px);
}
}

@media only screen and (max-width: 62em) {
.dashboard-column {
 flex-basis: calc(100% - 2px);
}
}

.dashboard-column .card {
border: 0;
}

.dashboard-column .card .iframe-moving {
display: block;
height: 100%;
min-height: 33em;
position: relative;
width: 100%;
}

@media only screen and (max-width: 46em) {
.dashboard-column .card .iframe-moving {
 min-height: 107em;
}
}
.dashboard-column .card .iframe-overview {
display: block;
height: 100%;
min-height: 22em;
width: 100%;
}

@media only screen and (max-width: 46em) {
.dashboard-column .card .iframe-overview {
 min-height: 18em;
}
}

.dashboard-column .card .iframe-battery-power {
display: block;
height: 60%;
min-height: 18em;
width: 100%;
}

@media only screen and (max-width: 46em) {
.dashboard-column .card .iframe-battery-power {
 min-height: 15em;
}
}

.dashboard-column .card .iframe-battery-soc {
display: block;
height: 40%;
min-height: 14em;
width: 100%;
}

@media only screen and (max-width: 46em) {
.dashboard-column .card .iframe-battery-soc {
 min-height: 12em;
}
}

/* Dark mode styles */
body.dark-mode {
    background-color: rgba(24, 27, 31, 1);
 color: #f5f6fa;
}

.dark-mode .main-content{
    background-color: rgba(24, 27, 31, 1);
    color: #f5f6fa;
}

.dark-mode .sidebar {
    background-color: rgba(24, 27, 31, 1);
}

.dark-mode .sidebar .logo-icon {
 color: #2f3640;
}

.dark-mode .sidebar .logo-text {
 color: #f5f6fa;
}

.dark-mode .sidebar nav li {
 color: #f5f6fa;
}

.dark-mode .sidebar nav li:hover {
 background-color: #383838;
}

.dark-mode .sidebar nav li a {
 color: #f5f6fa;
}

.dark-mode .sidebar nav li i {
 color: #dcdde1;
}

.dark-mode .toggle-sidebar,
.dark-mode .toggle-dark-mode {
 color: #f5f6fa;
}

.dark-mode .toggle-switch {
    background-color: var(--primary-color);
}

.dark-mode .toggle-switch.active {
 background-color: var(--primary-color);
}

.dark-mode header {
    background-color: rgb(17, 18, 23);
}

.dark-mode .content-card {
    background-color: rgba(24, 27, 31, 1);
 color: #fff;
}


.dark-mode .loading-overlay{
    background-color: rgba(24, 27, 31, 1);
}

/* Mobile Sidebar Improvements */
@media (max-width: 768px) {
    /* Sidebar base styles */
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 280px;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        z-index: 1000;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        box-shadow: none;
    }

    .sidebar.active {
        transform: translateX(0);
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.15);
    }

    /* Improved hamburger button */
    .mobile-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 1001;
        background: none;
        border: none;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 8px;
    }

    .mobile-toggle span {
        display: block;
        width: 24px;
        height: 2px;
        background-color: var(--text-color);
        margin: 5px auto;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .mobile-toggle.active span:nth-child(1) {
        transform: translateY(7px) rotate(45deg);
    }

    .mobile-toggle.active span:nth-child(2) {
        opacity: 0;
    }

    .mobile-toggle.active span:nth-child(3) {
        transform: translateY(-7px) rotate(-45deg);
    }

    /* Improved nav items */
    .sidebar nav ul {
        padding: 1rem 0;
    }

    .sidebar nav li {
        padding: 0.875rem 1.5rem;
        margin: 0.25rem 1rem;
        border-radius: 8px;
        transition: background-color 0.2s ease;
    }

    .sidebar nav li a {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 1rem;
        color: var(--text-color);
    }

    .sidebar nav li i {
        font-size: 1.25rem;
        min-width: 24px;
        text-align: center;
    }

    .sidebar nav li:active {
        background-color: rgba(0, 0, 0, 0.05);
    }

    /* Improved overlay */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(2px);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .sidebar-overlay.active {
        display: block;
        opacity: 1;
    }

    /* Dark mode adjustments */
    .dark-mode .mobile-toggle {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .dark-mode .mobile-toggle span {
        background-color: #f5f6fa;
    }

    .dark-mode .sidebar nav li:active {
        background-color: rgba(255, 255, 255, 0.05);
    }
}

/* Ensure main content adjusts properly */
@media (max-width: 768px) {
    .main-content {
        margin-left: 0;
        padding-top: 4.5rem;
        transition: margin-left 0.3s ease;
    }

    body.sidebar-open .main-content {
        filter: blur(2px);
        pointer-events: none;
    }
}


  /* Main content styling */
.main-content {
  flex: 1;
  margin-left: 280px;
  padding: 2rem;
  color: var(--text-color);
  transition: margin-left 0.3s ease;
}


.container {
    max-width: 1700px;
    padding: 0 var(--spacer);
    margin: 0 auto;
}

/* Header & Navigation */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: calc(var(--spacer) * 2);
    padding-bottom: var(--spacer);
    border-bottom: 1px solid var(--grey-300);
}

.breadcrumb {
    padding: var(--spacer) 0;
    margin-bottom: var(--spacer);
    list-style: none;
    background-color: transparent;
}

.breadcrumb-item {
    display: inline-block;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: "/";
    display: inline-block;
    padding: 0 0.5rem;
    color: var(--grey-600);
}

.breadcrumb-item a {
    color: var(--grey-600);
    text-decoration: none;
}

.breadcrumb-item.active {
    color: var(--grey-900);
    font-weight: var(--font-weight-bold);
}

/* Cards */
.card {
    background-color: #fff;
    border-radius: var(--border-radius);
    border: none;
    box-shadow: var(--box-shadow);
    margin-bottom: calc(var(--spacer) * 1.5);
    overflow: hidden;
    transition: var(--transition-slow);
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: var(--box-shadow-lg);
}

.card-header {
    padding: calc(var(--spacer) * 0.75) var(--spacer);
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    font-weight: var(--font-weight-bold);
    border-bottom: none;
}

.card-body {
    padding: var(--spacer);
}

.card-footer {
    padding: calc(var(--spacer) * 0.75) var(--spacer);
    background-color: var(--grey-100);
    border-top: 1px solid var(--grey-200);
}

/* Dashboard Summary Cards */
.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: var(--spacer);
    margin-bottom: calc(var(--spacer) * 1.5);
}

.summary-card {
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: var(--spacer);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition: var(--transition-slow);
}

.summary-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--box-shadow-lg);
}

.summary-card-icon {
    font-size: 2.5rem;
    margin-bottom: calc(var(--spacer) * 0.75);
    color: var(--primary);
}

.summary-card-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--grey-600);
    margin-bottom: calc(var(--spacer) * 0.5);
    font-weight: var(--font-weight-bold);
}

.summary-card-value {
    font-size: 2rem;
    font-weight: var(--font-weight-header);
    color: var(--dark);
}

/* Rule Cards */
.rule-card {
    transition: var(--transition-slow);
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: var(--spacer);
    overflow: hidden;
}

.rule-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--box-shadow-lg);
}

.rule-card.inactive {
    opacity: 0.7;
}

.rule-name {
    font-weight: var(--font-weight-bold);
    color: var(--grey-900);
    font-size: 1.1rem;
}

.rule-description {
    color: var(--grey-600);
    margin-bottom: var(--spacer);
}

.rule-date {
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: var(--grey-600);
}

/* Table Styles */
.table {
    width: 100%;
    margin-bottom: var(--spacer);
    color: var(--grey-800);
    border-collapse: separate;
    border-spacing: 0;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--box-shadow-sm);
}

.table th,
.table td {
    padding: 0.75rem;
    vertical-align: middle;
    border-top: 1px solid var(--grey-200);
}

.table thead th {
    vertical-align: bottom;
    border-bottom: 2px solid var(--grey-300);
    background-color: var(--grey-100);
    color: var(--grey-700);
    font-weight: var(--font-weight-bold);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    font-size: 0.85rem;
}

.table tbody tr {
    transition: var(--transition-base);
}

.table-hover tbody tr:hover {
    background-color: rgba(58, 134, 255, 0.05);
}

/* Buttons */
.btn {
    display: inline-block;
    font-weight: var(--font-weight-bold);
    color: var(--grey-700);
    text-align: center;
    vertical-align: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-color: transparent;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: var(--border-radius-sm);
    transition: var(--transition-base);
    box-shadow: var(--box-shadow-sm);
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
}

.btn-primary {
    color: #fff;
    background-color: var(--primary);
    border-color: var(--primary);
}

.btn-primary:hover {
    background-color: var(--primary-dark);
    border-color: var(--primary-dark);
}

.btn-success {
    color: #fff;
    background-color: var(--secondary);
    border-color: var(--secondary);
}

.btn-warning {
    color: #212529;
    background-color: var(--warning);
    border-color: var(--warning);
}

.btn-danger {
    color: #fff;
    background-color: var(--danger);
    border-color: var(--danger);
}

.btn-outline-primary {
    color: var(--primary);
    border-color: var(--primary);
}

.btn-outline-primary:hover {
    color: #fff;
    background-color: var(--primary);
    border-color: var(--primary);
}

.btn-outline-secondary {
    color: var(--grey-600);
    border-color: var(--grey-400);
}

.btn-outline-secondary:hover {
    color: var(--grey-800);
    background-color: var(--grey-200);
    border-color: var(--grey-400);
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    border-radius: var(--border-radius-sm);
}

/* Badges */
.badge {
    display: inline-block;
    padding: 0.35em 0.65em;
    font-size: 0.75em;
    font-weight: var(--font-weight-bold);
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: var(--border-radius-pill);
}

.bg-primary {
    background-color: var(--primary) !important;
    color: #fff;
}

.bg-secondary {
    background-color: var(--secondary) !important;
    color: #fff;
}

.bg-success {
    background-color: var(--secondary) !important;
    color: #fff;
}

.bg-warning {
    background-color: var(--warning) !important;
    color: #212529;
}

.bg-danger {
    background-color: var(--danger) !important;
    color: #fff;
}

.bg-info {
    background-color: var(--info) !important;
    color: #fff;
}

/* System Status Indicators */
.database-status {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 1000;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-pill);
    font-weight: var(--font-weight-bold);
    font-size: 0.85rem;
    box-shadow: var(--box-shadow);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.database-status.connected {
    background-color: var(--secondary);
    color: white;
}

.database-status.disconnected {
    background-color: var(--danger);
    color: white;
}

.system-state-badge {
    padding: 0.5rem 0.75rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    border-radius: var(--border-radius-pill);
    font-size: 0.85rem;
    font-weight: var(--font-weight-bold);
    display: inline-block;
}

/* Rule Type Icons */
.rule-type-icon {
    font-size: 1.5rem;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin-right: 1rem;
}

.rule-type-icon.battery {
    background-color: rgba(56, 176, 0, 0.15);
    color: var(--battery-color);
}

.rule-type-icon.energy {
    background-color: rgba(255, 190, 11, 0.15);
    color: var(--solar-color);
}

.rule-type-icon.grid {
    background-color: rgba(255, 0, 110, 0.15);
    color: var(--grid-color);
}

.rule-type-icon.time {
    background-color: rgba(58, 134, 255, 0.15);
    color: var(--primary);
}

.trigger-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background-color: var(--primary);
    color: white;
    font-weight: var(--font-weight-bold);
    margin-right: 0.5rem;
}

/* Filtering Controls */
.filtering-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: calc(var(--spacer) * 1.5);
    flex-wrap: wrap;
    gap: var(--spacer);
}

.input-group {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    align-items: stretch;
    width: 100%;
}

.input-group-text {
    display: flex;
    align-items: center;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: var(--grey-700);
    text-align: center;
    white-space: nowrap;
    background-color: var(--grey-200);
    border: 1px solid var(--grey-300);
    border-radius: var(--border-radius-sm) 0 0 var(--border-radius-sm);
}

.form-control {
    display: block;
    width: 100%;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: var(--grey-700);
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid var(--grey-300);
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border-radius: var(--border-radius-sm);
    transition: var(--transition-base);
}

.form-control:focus {
    color: var(--grey-900);
    background-color: #fff;
    border-color: var(--primary);
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(58, 134, 255, 0.25);
}

/* Toggle Switch */
.form-check-input {
    width: 2.5em;
    height: 1.25em;
    margin-top: 0.125em;
    margin-right: 0.5em;
    background-color: var(--grey-400);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
    background-position: left center;
    background-repeat: no-repeat;
    background-size: contain;
    border: none;
    transition: background-position 0.15s ease-in-out;
    appearance: none;
    border-radius: 2em;
}

.form-check-input:checked {
    background-color: var(--secondary);
    background-position: right center;
}

.form-check-input:focus {
    outline: none;
    box-shadow: 0 0 0 0.25rem rgba(58, 134, 255, 0.25);
}

.form-switch .form-check-input {
    margin-left: 0;
}

.form-check {
    display: flex;
    align-items: center;
    padding-left: 0;
    margin-bottom: 0;
}

.form-check-label {
    margin-bottom: 0;
}

/* Action Buttons Group */
.action-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: calc(var(--spacer) * 3) var(--spacer);
}

.empty-state-icon {
    font-size: 3rem;
    color: var(--grey-400);
    margin-bottom: var(--spacer);
}

.empty-state-text {
    color: var(--grey-600);
    font-size: 1.2rem;
    margin-bottom: var(--spacer);
}

/* Wizard Styles */
.wizard-nav {
    margin-bottom: calc(var(--spacer) * 2);
}

/* New Step Indicators with Numbers */
.wizard-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 1;
}

.wizard-steps::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--grey-300);
    transform: translateY(-50%);
    z-index: -1;
}

.wizard-step-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.wizard-step-number {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: var(--grey-200);
    color: var(--grey-600);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 0.5rem;
    border: 2px solid var(--grey-300);
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
}

.wizard-step-indicator.active .wizard-step-number {
    background-color: var(--primary);
    color: white;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(58, 134, 255, 0.25);
}

.wizard-step-indicator.completed .wizard-step-number {
    background-color: var(--secondary);
    color: white;
    border-color: var(--secondary);
}

.wizard-step-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--grey-600);
    text-align: center;
    max-width: 100px;
}

.wizard-step-indicator.active .wizard-step-text {
    color: var(--primary);
}

.wizard-step-indicator.completed .wizard-step-text {
    color: var(--secondary);
}

/* Old Progress Bar (can be removed if using the step indicators above) */
.progress {
    height: var(--wizard-progress-height);
    background-color: var(--wizard-inactive-color);
    border-radius: var(--border-radius-pill);
    overflow: hidden;
    box-shadow: var(--box-shadow-inset);
    margin-top: 1rem;
}

.progress-bar {
    background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 var(--spacer);
    font-size: 1rem;
    font-weight: var(--font-weight-bold);
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    height: 100%;
}

.wizard-step {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.wizard-step.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.condition-card, 
.action-card {
    background-color: white;
    border-radius: var(--border-radius);
    margin-bottom: calc(var(--spacer) * 1.2);
    transition: var(--transition-base);
    border: 1px solid var(--grey-300);
    box-shadow: var(--box-shadow-sm);
    overflow: hidden;
}

.condition-card:hover,
.action-card:hover {
    box-shadow: var(--box-shadow);
    transform: translateY(-2px);
    border-color: var(--primary);
    border-left: 3px solid var(--primary);
}

.condition-card .card-body,
.action-card .card-body {
    padding: calc(var(--spacer) * 1.2);
}

.preview-container {
    background-color: var(--grey-100);
    border: 1px solid var(--grey-300);
    border-radius: var(--border-radius);
    padding: var(--spacer);
    margin-bottom: calc(var(--spacer) * 1.2);
}

.preview-line {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.preview-line strong {
    color: var(--grey-800);
}

.preview-line.ms-3 {
    padding-left: 1rem;
    border-left: 2px solid var(--grey-300);
}

.date-tag {
    display: inline-flex;
    align-items: center;
    background-color: var(--primary);
    color: white;
    padding: 0.25rem 0.75rem;
    margin: 0.25rem;
    border-radius: var(--border-radius-pill);
    font-size: 0.85rem;
    font-weight: var(--font-weight-bold);
    transition: var(--transition-base);
}

.date-tag:hover {
    background-color: var(--primary-dark);
}

.date-tag .close {
    margin-left: 0.5rem;
    cursor: pointer;
    font-size: 1.2rem;
    line-height: 1;
    opacity: 0.8;
    transition: var(--transition-fast);
}

.date-tag .close:hover {
    opacity: 1;
}

.calendar-dates {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.calendar-dates.show {
    display: block;
}

.success-message {
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1050;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

/* Flatpickr customization */
.flatpickr-calendar {
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow-lg);
    border: none;
}

.flatpickr-day.selected, 
.flatpickr-day.startRange, 
.flatpickr-day.endRange, 
.flatpickr-day.selected.inRange, 
.flatpickr-day.startRange.inRange, 
.flatpickr-day.endRange.inRange, 
.flatpickr-day.selected:focus, 
.flatpickr-day.startRange:focus, 
.flatpickr-day.endRange:focus, 
.flatpickr-day.selected:hover, 
.flatpickr-day.startRange:hover, 
.flatpickr-day.endRange:hover, 
.flatpickr-day.selected.prevMonthDay, 
.flatpickr-day.startRange.prevMonthDay, 
.flatpickr-day.endRange.prevMonthDay, 
.flatpickr-day.selected.nextMonthDay, 
.flatpickr-day.startRange.nextMonthDay, 
.flatpickr-day.endRange.nextMonthDay {
    background: var(--primary);
    border-color: var(--primary);
}

.flatpickr-day.selected.startRange + .endRange:not(:nth-child(7n+1)), 
.flatpickr-day.startRange.startRange + .endRange:not(:nth-child(7n+1)), 
.flatpickr-day.endRange.startRange + .endRange:not(:nth-child(7n+1)) {
    box-shadow: -10px 0 0 var(--primary);
}

.flatpickr-time input:hover, 
.flatpickr-time .flatpickr-am-pm:hover, 
.flatpickr-time input:focus, 
.flatpickr-time .flatpickr-am-pm:focus {
    background: var(--grey-100);
}

/* Day of Week Selectors */
.days-of-week-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 1.5rem;
}

.day-selector {
    position: relative;
}

.day-selector input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

.day-selector label {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--grey-200);
    color: var(--grey-700);
    font-weight: var(--font-weight-bold);
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
    margin: 0;
}

.day-selector input[type="checkbox"]:checked + label {
    background-color: var(--primary);
    color: white;
    box-shadow: 0 0 0 2px rgba(58, 134, 255, 0.25);
}

.day-selector:hover label {
    background-color: var(--grey-300);
}

.day-selector input[type="checkbox"]:checked:hover + label {
    background-color: var(--primary-dark);
}

.day-selector input[type="checkbox"]:focus + label {
    box-shadow: 0 0 0 3px rgba(58, 134, 255, 0.25);
}

/* Form improvements for the wizard */
.form-label {
    font-weight: var(--font-weight-bold);
    color: var(--grey-700);
    margin-bottom: 0.5rem;
}

.form-control, 
.form-select {
    border-radius: var(--border-radius-sm);
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--grey-300);
    transition: var(--transition-base);
}

.form-control:focus, 
.form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(58, 134, 255, 0.25);
}

.form-text {
    color: var(--grey-600);
    font-size: 0.85rem;
    margin-top: 0.25rem;
}

.form-switch .form-check-input {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
}

.form-check-label {
    color: var(--grey-700);
}

/* Modal Styles */
.modal-content {
    border-radius: var(--border-radius);
    border: none;
    box-shadow: var(--box-shadow-lg);
}

.modal-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border-bottom: none;
    padding: 1rem 1.5rem;
}

.modal-title {
    font-weight: var(--font-weight-bold);
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    border-top: 1px solid var(--grey-200);
    padding: 1rem 1.5rem;
}

/* Condition & Action Lists */
.condition-text, 
.action-text {
    padding: 0.5rem 0.75rem;
    margin-bottom: 0.5rem;
    background-color: var(--grey-100);
    border-radius: var(--border-radius-sm);
    font-size: 0.9rem;
}

/* Responsive fixes for main-content */
@media (max-width: 768px) {
    .main-content {
        margin-left: 0;
        padding: 1rem;
        transition: margin-left 0.3s ease;
    }
    
    /* Better form layout on mobile */
    .wizard-step .row > [class*="col-"] {
        margin-bottom: 1rem;
    }
    
    /* Make wizard steps more mobile-friendly */
    .wizard-steps {
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
    }
    
    .wizard-step-indicator {
        flex: 0 0 auto;
        width: 45%;
        margin-bottom: 1rem;
    }
    
    /* Improve buttons layout on mobile */
    .wizard-step .d-flex.justify-content-between {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .wizard-step .d-flex.justify-content-between button {
        width: 100%;
    }
    
    /* Better card layout on mobile */
    .condition-card .row,
    .action-card .row {
        flex-direction: column;
    }
    
    .condition-card .col-md-1,
    .action-card .col-md-1 {
        align-self: flex-end;
        margin-top: 0.5rem;
    }
    
    /* Adjust date picker layout */
    #specificDatesContainer .row {
        flex-direction: column;
    }
    
    #specificDatesContainer .col-md-6 {
        margin-bottom: 1rem;
    }
}

/* Dark mode improvements for main-content */
.dark-mode .main-content {
    background-color: rgba(24, 27, 31, 1);
    color: #f5f6fa;
}

/* Fix for the main container */
.dark-mode .main-content > .container {
    background-color: rgba(24, 27, 31, 1);
}
.dark-mode .container .mt-4 {
    background-color: rgba(24, 27, 31, 1);
    color: #f5f6fa;
}
/* Form elements in dark mode */
.dark-mode .form-control,
.dark-mode .form-select {
    background-color: rgba(17, 18, 23, 1);
    border-color: #495057;
    color: #f5f6fa;
}

.dark-mode .form-control:focus,
.dark-mode .form-select:focus {
    background-color: rgba(33, 37, 41, 1);
    border-color: var(--primary);
    color: #f5f6fa;
}

.dark-mode .form-label,
.dark-mode .form-check-label {
    color: #f5f6fa;
}
/* Enhanced Dark Mode for Main Content Elements */
.dark-mode .card {
    background-color: rgba(24, 27, 31, 1);
    color: #f5f6fa;
}

.dark-mode .card-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
}

.dark-mode .card-body {
    color: #f5f6fa;
}

.dark-mode .form-control,
.dark-mode .form-select,
.dark-mode .time-picker,
.dark-mode .date-picker {
    background-color: rgba(33, 37, 41, 1);
    border-color: #495057;
    color: #f5f6fa;
}

.dark-mode .form-control:focus,
.dark-mode .form-select:focus {
    background-color: rgba(33, 37, 41, 1);
    border-color: var(--primary);
    color: #f5f6fa;
}

.dark-mode .form-check-label {
    color: #f5f6fa;
}

.dark-mode .text-muted {
    color: #adb5bd !important;
}

.dark-mode .preview-container {
    background-color: rgba(33, 37, 41, 1);
    border-color: #495057;
}

.dark-mode .wizard-step-text {
    color: #f5f6fa;
}

.dark-mode .wizard-step-indicator.active .wizard-step-text {
    color: var(--primary);
}

.dark-mode .day-selector label {
    background-color: rgba(33, 37, 41, 1);
    color: #f5f6fa;
}

.dark-mode .day-selector:hover label {
    background-color: #495057;
}

.dark-mode .wizard-steps::before {
    background-color: #495057;
}

.dark-mode .wizard-step-number {
    background-color: rgba(33, 37, 41, 1);
    border-color: #495057;
    color: #f5f6fa;
}

.dark-mode .condition-card,
.dark-mode .action-card {
    background-color: rgba(17, 18, 23, 1);
    border-color: #495057;
}

.dark-mode .condition-card:hover,
.dark-mode .action-card:hover {
    border-color: var(--primary);
}

/* Fix for flatpickr in dark mode */
.dark-mode .flatpickr-calendar {
    background-color: rgba(33, 37, 41, 1);
    color: #f5f6fa;
    box-shadow: 0 3px 13px rgba(0, 0, 0, 0.5);
}

.dark-mode .flatpickr-day {
    color: #f5f6fa;
}

.dark-mode .flatpickr-months .flatpickr-month,
.dark-mode .flatpickr-current-month .flatpickr-monthDropdown-months,
.dark-mode .flatpickr-weekday {
    color: #f5f6fa;
    fill: #f5f6fa;
}

.dark-mode .flatpickr-time input,
.dark-mode .flatpickr-time .flatpickr-am-pm {
    background-color: rgba(33, 37, 41, 1);
    color: #f5f6fa;
}

.dark-mode .flatpickr-day.today {
    border-color: var(--primary);
}

.dark-mode .flatpickr-day.selected {
    background: var(--primary);
    color: white;
}

/* Enhanced Responsive Design for Wizard */
@media (max-width: 768px) {
    .wizard-steps {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .wizard-step-indicator {
        flex-basis: 40%;
        margin-bottom: 0.75rem;
    }
    
    .wizard-step-text {
        font-size: 0.75rem;
    }
    
    .wizard-step-number {
        width: 40px;
        height: 40px;
    }
    
    .form-label {
        margin-top: 0.75rem;
    }
    
    /* Better organization for condition and action cards on mobile */
    .condition-card .row,
    .action-card .row {
        display: flex;
        flex-direction: column;
    }
    
    .condition-card .col-md-1,
    .action-card .col-md-1 {
        margin-top: 1rem;
        align-self: flex-end;
    }
    
    .condition-card .col-md-3,
    .condition-card .col-md-4,
    .action-card .col-md-3,
    .action-card .col-md-4 {
        width: 100%;
        margin-bottom: 0.5rem;
    }
    
    /* Improve button layout on mobile */
    .d-flex.justify-content-between {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    /* Calendar date selector improvements */
    .day-selector {
        margin-bottom: 0.5rem;
    }
    
    .days-of-week-container {
        justify-content: center;
    }
    
    /* Better time picker layout */
    #timeRestrictionsContainer .row {
        flex-direction: column;
    }
    
    /* Specific dates container */
    #specificDatesContainer .row {
        flex-direction: column;
    }
    
    #specificDatesContainer .col-md-6 {
        width: 100%;
        margin-bottom: 1rem;
    }
    
    /* Make preview more readable on mobile */
    .preview-line {
        word-break: break-word;
    }
    
    /* Better card spacing on mobile */
    .card {
        margin-bottom: 1rem;
    }
    
    .card-body {
        padding: 0.75rem;
    }
}

/* Improved date tag display for mobile */
.date-tag {
    margin-bottom: 0.5rem;
}

/* Fix for time pickers */
.flatpickr-calendar {
    width: 100%;
    max-width: 240px;
}

@media (max-width: 400px) {
    .wizard-step-indicator {
        flex-basis: 100%;
    }
}

/* Utility Classes */
.mt-1 { margin-top: 0.25rem !important; }
.mt-2 { margin-top: 0.5rem !important; }
.mt-3 { margin-top: 1rem !important; }
.mt-4 { margin-top: 1.5rem !important; }
.mt-5 { margin-top: 3rem !important; }

.mb-1 { margin-bottom: 0.25rem !important; }
.mb-2 { margin-bottom: 0.5rem !important; }
.mb-3 { margin-bottom: 1rem !important; }
.mb-4 { margin-bottom: 1.5rem !important; }
.mb-5 { margin-bottom: 3rem !important; }

.ml-1 { margin-left: 0.25rem !important; }
.ml-2 { margin-left: 0.5rem !important; }
.ml-3 { margin-left: 1rem !important; }
.ml-4 { margin-left: 1.5rem !important; }
.ml-5 { margin-left: 3rem !important; }

.mr-1 { margin-right: 0.25rem !important; }
.mr-2 { margin-right: 0.5rem !important; }
.mr-3 { margin-right: 1rem !important; }
.mr-4 { margin-right: 1.5rem !important; }
.mr-5 { margin-right: 3rem !important; }

.p-1 { padding: 0.25rem !important; }
.p-2 { padding: 0.5rem !important; }
.p-3 { padding: 1rem !important; }
.p-4 { padding: 1.5rem !important; }
.p-5 { padding: 3rem !important; }

.text-center { text-align: center !important; }
.text-start { text-align: left !important; }
.text-end { text-align: right !important; }

.text-muted { color: var(--grey-600) !important; }
.text-primary { color: var(--primary) !important; }
.text-success { color: var(--secondary) !important; }
.text-warning { color: var(--warning) !important; }
.text-danger { color: var(--danger) !important; }

.btn-secondaryy{
    background: #DC3545;
    color: #fff;
}

.btn-secondaryy:hover{
    background: #c83442;
    color: #fff;
}

.btn-primaryy{
  background: #DEAF0B;
  color: #fff;
}
.btn-primaryy:hover{
  background: #c29b0f;
  color: #fff;
}


.title-container {
            width: 100%;
            max-width: 1700px;
            margin-bottom: 20px;
        }
        
        .wizard-header {
            background: linear-gradient(135deg, #DEAF0B, #c29b0f);
            border-radius: 12px;
            padding: 24px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(222, 175, 11, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .wizard-title {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
        }
        
        .wizard-title-icon {
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.2);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .wizard-title-text {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .wizard-subtitle {
            color: rgba(255, 255, 255, 0.9);
            margin: 8px 0 0 57px;
            font-size: 15px;
            font-weight: 400;
            position: relative;
            z-index: 2;
        }
        
        .pattern-overlay {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 40%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.6;
            z-index: 1;
        }
        
        
        body.dark-mode .wizard-header {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }
        
        /* Animated Elements */
        .lightning-bolt {
            position: absolute;
            top: 15px;
            right: 45px;
            width: 24px;
            height: 24px;
            z-index: 2;
            animation: pulse 2s infinite;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.7));
        }
        
        .gear {
            position: absolute;
            width: 18px;
            height: 18px;
            z-index: 2;
            animation: rotate 10s linear infinite;
        }
        
        .gear-1 {
            top: 25px;
            right: 80px;
        }
        
        .gear-2 {
            bottom: 20px;
            right: 100px;
            width: 14px;
            height: 14px;
            animation-direction: reverse;
            animation-duration: 7s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
</style>
</head>
<body>
      <!-- Add hamburger menu button -->
      <button class="mobile-toggle" id="mobileToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <div class="container">
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
          </div>
          <div id="pageContent"> </div>

          <div class="sidebar" id="sidebar">
            <div class="logo">
              <div class="logo-icon">
                <img src="https://carbonoz.com/assets/images/image04.jpg?v=8b5d1d9b" width="45px" alt="">
              </div>
              <a href="https://carbonoz.com/" target="_blank" style="text-decoration: none;">
                <span class="logo-text">CARBONOZ <span class="highlight">SolarAutopilot</span></span>
              </a>
            </div>
          
            <nav>
              <ul>
                <li><a href="/"><i>🏠</i><span>Dashboard</span></a></li>
                <li><a href="/chart"><i>📊</i><span>Charts</span></a></li>
                <li><a href="/messages"><i>💬</i><span>Messages</span></a></li>
                <li><a href="/settings"><i>⚙️</i><span>Settings</span></a></li>
                <li><a href="/analytics"><i>📈</i><span>Analytics</span></a></li>
                <li><a href="/learner"><i>🧠</i><span>Learner Mode</span></a></li>
                <li><a href="/results"><i>🌱</i><span>Carbon Intensity</span></a></li>
              </ul>
            </nav>
            
            <div class="bottom-options">
              <div class="toggle-dark-mode" id="toggleDarkMode">
                <span class="toggle-text">Dark Mode</span>
                <div class="toggle-switch" id="darkModeSwitch"></div>
              </div>
            </div>
          </div>
          
     

          <div class="main-content">

            <div class="container">
                <div class="d-flex flex-wrap justify-content-center gap-3 p-2 rounded shadow-sm">
            
                <div class="container mt-4">
                    <div class="success-message alert alert-success alert-dismissible fade show" role="alert">
                        <strong>Success!</strong> Your rule has been created successfully.
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    
                    <div class="title-container">
                        <div class="wizard-header">
                            <h1 class="wizard-title">
                                <div class="wizard-title-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 22V3"></path>
                                        <path d="M5 12H2"></path>
                                        <path d="M22 12h-3"></path>
                                        <path d="M12 5l-3 3"></path>
                                        <path d="M12 5l3 3"></path>
                                    </svg>
                                </div>
                                <span class="wizard-title-text">Energy Management Rule Wizard</span>
                            </h1>
                            <p class="wizard-subtitle">Create and customize automated energy rules for optimal efficiency</p>
                            
                            <!-- Animated elements -->
                            <svg class="lightning-bolt" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                            </svg>
                            
                            <svg class="gear gear-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            
                            <svg class="gear gear-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                            
                            <div class="pattern-overlay"></div>
                        </div>
                    </div>
                    
                    <div class="wizard-nav">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">Step 1 of 4</div>
                        </div>
                    </div>
                    
                    <form id="ruleWizardForm">
                        <!-- Step 1: Basic Information -->
                        <div class="wizard-step active" id="step1">
                            <div class="card mb-4">
                                <div class="card-header">
                                    Step 1: Basic Information
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="ruleName" class="form-label">Rule Name *</label>
                                        <input type="text" class="form-control" id="ruleName" name="name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="ruleDescription" class="form-label">Description</label>
                                        <textarea class="form-control" id="ruleDescription" name="description" rows="3"></textarea>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="ruleActive" name="active" checked>
                                        <label class="form-check-label" for="ruleActive">Rule Active</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondaryy" onclick="window.location.href='/rules'">Cancel</button>
                                <button type="button" class="btn btn-primaryy" onclick="nextStep(1)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 2: Conditions -->
                        <div class="wizard-step" id="step2">
                            <div class="card mb-4">
                                <div class="card-header">
                                    Step 2: Conditions
                                </div>
                                <div class="card-body">
                                    <p class="text-muted">Define when this rule should run. Add one or more conditions that must be met.</p>
                                    
                                    <div id="conditionsContainer">
                                        <!-- Conditions will be added here dynamically -->
                                    </div>
                                    
                                    <button type="button" class="btn btn-outline-secondary" onclick="addCondition()">
                                        <i class="bi bi-plus-circle"></i> Add Condition
                                    </button>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondaryy" onclick="prevStep(2)">Previous</button>
                                <button type="button" class="btn btn-primaryy" onclick="nextStep(2)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Time Restrictions -->
                        <div class="wizard-step" id="step3">
                            <div class="card mb-4">
                                <div class="card-header">
                                    Step 3: Time Restrictions
                                </div>
                                <div class="card-body">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="enableTimeRestrictions" name="timeRestrictionsEnabled">
                                        <label class="form-check-label" for="enableTimeRestrictions">Enable Time Restrictions</label>
                                    </div>
                                    
                                    <div id="timeRestrictionsContainer" style="display: none;">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Days of Week</label>
                                                <div class="d-flex flex-wrap">
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="dayMonday" name="days" value="monday">
                                                        <label class="form-check-label" for="dayMonday">Monday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="dayTuesday" name="days" value="tuesday">
                                                        <label class="form-check-label" for="dayTuesday">Tuesday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="dayWednesday" name="days" value="wednesday">
                                                        <label class="form-check-label" for="dayWednesday">Wednesday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="dayThursday" name="days" value="thursday">
                                                        <label class="form-check-label" for="dayThursday">Thursday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="dayFriday" name="days" value="friday">
                                                        <label class="form-check-label" for="dayFriday">Friday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="daySaturday" name="days" value="saturday">
                                                        <label class="form-check-label" for="daySaturday">Saturday</label>
                                                    </div>
                                                    <div class="form-check me-3">
                                                        <input class="form-check-input" type="checkbox" id="daySunday" name="days" value="sunday">
                                                        <label class="form-check-label" for="daySunday">Sunday</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="startTime" class="form-label">Start Time</label>
                                                <input type="text" class="form-control time-picker" id="startTime" name="startTime" placeholder="HH:MM">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="endTime" class="form-label">End Time</label>
                                                <input type="text" class="form-control time-picker" id="endTime" name="endTime" placeholder="HH:MM">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="enableSpecificDates" name="enableSpecificDates">
                                                <label class="form-check-label" for="enableSpecificDates">Enable Specific Dates (Holiday Mode)</label>
                                            </div>
                                        </div>
                                        
                                        <div class="calendar-dates" id="specificDatesContainer">
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <label for="specificDate" class="form-label">Select Date</label>
                                                    <div class="input-group">
                                                        <input type="text" class="form-control date-picker" id="specificDate" placeholder="YYYY-MM-DD">
                                                        <button class="btn btn-outline-secondary" type="button" id="addDateBtn">Add</button>
                                                    </div>
                                                    <small class="form-text text-muted">Add specific dates to the calendar (e.g., holidays, vacations)</small>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label">Selected Dates</label>
                                                    <div id="selectedDates" class="p-2 border rounded">
                                                        <!-- Selected dates will appear here -->
                                                        <p class="text-muted mb-0" id="noDatesMessage">No dates selected</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <input type="hidden" id="calendarDates" name="calendarDates" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondaryy" onclick="prevStep(3)">Previous</button>
                                <button type="button" class="btn btn-primaryy" onclick="nextStep(3)">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 4: Actions -->
                        <div class="wizard-step" id="step4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    Step 4: Actions
                                </div>
                                <div class="card-body">
                                    <p class="text-muted">Define what actions should be taken when conditions are met.</p>
                                    
                                    <div id="actionsContainer">
                                        <!-- Actions will be added here dynamically -->
                                    </div>
                                    
                                    <button type="button" class="btn btn-outline-secondary" onclick="addAction()">
                                        <i class="bi bi-plus-circle"></i> Add Action
                                    </button>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    Rule Preview
                                </div>
                                <div class="card-body">
                                    <div class="preview-container">
                                        <div id="rulePreview">
                                            <!-- Rule preview will be shown here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondaryy" onclick="prevStep(4)">Previous</button>
                                <button type="button" class="btn btn-primaryy" onclick="saveRule()">Save Rule</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
          
            
            
        </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="/js/loading.js"></script>
  <script src="/js/dark-mode.js"></script>
  <script src="/js/mobile.js"></script>
    
       
      
<script>
       // loading js
        
   document.addEventListener('DOMContentLoaded', function() {
    const loadingOverlay = document.getElementById('loadingOverlay');
    const pageContent = document.getElementById('pageContent');
  
    // Simulate loading time (you can adjust this as needed)
    setTimeout(() => {
      loadingOverlay.style.display = 'none';
      pageContent.style.display = 'block';
      // Trigger a custom event to signal that the page is ready
      document.dispatchEvent(new Event('pageReady'));
    }, 1500); // 1.5 seconds loading time
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
let conditions = [];
let actions = [];
let selectedDates = [];
let currentStep = 1;

// Initialize when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    // Insert step indicators before the progress bar
    insertStepIndicators();
    
    // Initialize time pickers
    document.querySelectorAll('.time-picker').forEach(el => {
        flatpickr(el, {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true
        });
    });
    
    // Initialize date picker
    flatpickr('.date-picker', {
        dateFormat: "Y-m-d",
    });
    
    // Setup event listeners
    document.getElementById('enableTimeRestrictions').addEventListener('change', function() {
        document.getElementById('timeRestrictionsContainer').style.display = this.checked ? 'block' : 'none';
    });
    
    document.getElementById('enableSpecificDates').addEventListener('change', function() {
        document.getElementById('specificDatesContainer').classList.toggle('show', this.checked);
    });
    
    document.getElementById('addDateBtn').addEventListener('click', function() {
        const dateInput = document.getElementById('specificDate');
        const date = dateInput.value;
        
        if (date && !selectedDates.includes(date)) {
            selectedDates.push(date);
            updateSelectedDates();
            dateInput.value = '';
        }
    });
    
    // Add initial condition and action
    addCondition();
    addAction();
    
    // Update the rule preview
    updateRulePreview();
    
    // Update step indicators for initial state
    updateStepIndicators(currentStep);
});

/**
 * Create and insert step indicators
 */
function insertStepIndicators() {
    const wizardNav = document.querySelector('.wizard-nav');
    const stepsContainer = document.createElement('div');
    stepsContainer.className = 'wizard-steps';
    
    // Step titles
    const stepTitles = [
        'Basic Information',
        'Conditions',
        'Time Restrictions',
        'Actions'
    ];
    
    // Create individual step indicators
    stepTitles.forEach((title, index) => {
        const stepNumber = index + 1;
        const stepIndicator = document.createElement('div');
        stepIndicator.className = 'wizard-step-indicator';
        stepIndicator.id = `step-indicator-${stepNumber}`;
        
        stepIndicator.innerHTML = `
            <div class="wizard-step-number">${stepNumber}</div>
            <div class="wizard-step-text">${title}</div>
        `;
        
        stepsContainer.appendChild(stepIndicator);
    });
    
    // Insert before the progress bar
    wizardNav.insertBefore(stepsContainer, wizardNav.firstChild);
}

/**
 * Update step indicators to reflect the current step
 * @param {number} currentStep - The current step (1-based index)
 */
function updateStepIndicators(step) {
    // Clear all indicators
    document.querySelectorAll('.wizard-step-indicator').forEach((indicator, index) => {
        const stepNumber = index + 1;
        
        if (stepNumber < step) {
            // Completed steps
            indicator.className = 'wizard-step-indicator completed';
        } else if (stepNumber === step) {
            // Active step
            indicator.className = 'wizard-step-indicator active';
        } else {
            // Future steps
            indicator.className = 'wizard-step-indicator';
        }
    });
    
    // Also update the progress bar for compatibility
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        progressBar.style.width = `${25 * step}%`;
        progressBar.setAttribute('aria-valuenow', 25 * step);
        progressBar.textContent = `Step ${step} of 4`;
    }
}

// Navigation functions
function nextStep(step) {
    // Validate current step
    if (step === 1) {
        if (!document.getElementById('ruleName').value) {
            alert('Please enter a rule name');
            return;
        }
    } else if (step === 2) {
        updateConditionsFromUI();
        if (conditions.length === 0) {
            if (!confirm('Are you sure you want to continue without any conditions? The rule will always execute.')) {
                return;
            }
        }
    } else if (step === 3) {
        const timeRestrictionsEnabled = document.getElementById('enableTimeRestrictions').checked;
        if (timeRestrictionsEnabled) {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (!startTime || !endTime) {
                alert('Please set both start and end times');
                return;
            }
            
            const daysSelected = Array.from(document.querySelectorAll('input[name="days"]:checked')).length > 0;
            if (!daysSelected) {
                alert('Please select at least one day of the week');
                return;
            }
        }
    }
    
    // Hide current step, show next step
    document.getElementById(`step${step}`).classList.remove('active');
    document.getElementById(`step${step+1}`).classList.add('active');
    currentStep = step + 1;
    
    // Update step indicators
    updateStepIndicators(currentStep);
    
    // Update rule preview in the last step
    if (currentStep === 4) {
        updateRulePreview();
    }
}

function prevStep(step) {
    document.getElementById(`step${step}`).classList.remove('active');
    document.getElementById(`step${step-1}`).classList.add('active');
    currentStep = step - 1;
    
    // Update step indicators
    updateStepIndicators(currentStep);
}

// Add a new condition
function addCondition() {
    const conditionId = `condition-${Date.now()}`;
    const conditionsContainer = document.getElementById('conditionsContainer');
    
    const conditionHTML = `
        <div class="condition-card" id="${conditionId}">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Parameter</label>
                        <select class="form-select condition-parameter" onchange="updateConditionOperatorOptions(this)">
                            <option value="battery_soc">Battery SOC (%)</option>
                            <option value="pv_power">PV Power (W)</option>
                            <option value="load">Load Power (W)</option>
                            <option value="grid_voltage">Grid Voltage (V)</option>
                            <option value="grid_power">Grid Power (W)</option>
                            <option value="battery_voltage">Battery Voltage (V)</option>
                            <option value="battery_current">Battery Current (A)</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Operator</label>
                        <select class="form-select condition-operator">
                            <option value="gt">Greater than (>)</option>
                            <option value="lt">Less than (<)</option>
                            <option value="eq">Equal to (=)</option>
                            <option value="gte">Greater than or equal to (≥)</option>
                            <option value="lte">Less than or equal to (≤)</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Value</label>
                        <input type="number" class="form-control condition-value" step="0.1">
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeCondition('${conditionId}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    conditionsContainer.insertAdjacentHTML('beforeend', conditionHTML);
}

// Remove a condition
function removeCondition(conditionId) {
    document.getElementById(conditionId).remove();
}

// Update operator options based on parameter
function updateConditionOperatorOptions(parameterSelect) {
    const operatorSelect = parameterSelect.closest('.row').querySelector('.condition-operator');
    
    // Reset options
    operatorSelect.innerHTML = `
        <option value="gt">Greater than (>)</option>
        <option value="lt">Less than (<)</option>
        <option value="eq">Equal to (=)</option>
        <option value="gte">Greater than or equal to (≥)</option>
        <option value="lte">Less than or equal to (≤)</option>
    `;
}

// Add a new action
function addAction() {
    const actionId = `action-${Date.now()}`;
    const actionsContainer = document.getElementById('actionsContainer');
    
    const actionHTML = `
        <div class="action-card" id="${actionId}">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label class="form-label">Setting</label>
                        <select class="form-select action-setting" onchange="updateActionValueOptions(this)">
                            <option value="grid_charge">Grid Charge</option>
                            <option value="energy_pattern">Energy Pattern</option>
                            <option value="work_mode">Work Mode</option>
                            <option value="max_discharge_current">Max Discharge Current</option>
                            <option value="max_charge_current">Max Charge Current</option>
                            <option value="max_grid_charge_current">Max Grid Charge Current</option>
                            <option value="solar_export_when_battery_full">Solar Export When Battery Full</option>
                            <option value="max_sell_power">Max Sell Power</option>
                            <option value="remote_switch">Remote Switch</option>
                            <option value="generator_charge">Generator Charge</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Value</label>
                        <select class="form-select action-value">
                            <option value="Enabled">Enabled</option>
                            <option value="Disabled">Disabled</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Inverter</label>
                        <select class="form-select action-inverter">
                            <option value="all">All Inverters</option>
                            <option value="inverter_1">Inverter 1</option>
                            <option value="inverter_2">Inverter 2</option>
                             <option value="inverter_3">Inverter 1</option>
                            <option value="inverter_4">Inverter 2</option>
                             <option value="inverter_5">Inverter 1</option>
                            <option value="inverter_6">Inverter 2</option>
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAction('${actionId}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    actionsContainer.insertAdjacentHTML('beforeend', actionHTML);
}

// Remove an action
function removeAction(actionId) {
    document.getElementById(actionId).remove();
}

// Update value options based on setting
function updateActionValueOptions(settingSelect) {
    const valueSelect = settingSelect.closest('.row').querySelector('.action-value');
    const setting = settingSelect.value;
    
    // Clear existing options
    valueSelect.innerHTML = '';
    
    // Add appropriate options based on setting
    if (setting === 'grid_charge' || setting === 'generator_charge' || 
        setting === 'remote_switch' || setting === 'solar_export_when_battery_full') {
        valueSelect.innerHTML = `
            <option value="Enabled">Enabled</option>
            <option value="Disabled">Disabled</option>
        `;
    } else if (setting === 'energy_pattern' || setting === 'work_mode') {
        valueSelect.innerHTML = `
            <option value="Battery first">Battery first</option>
            <option value="Grid first">Load first</option>
         
        `;
    } else if (setting === 'max_discharge_current' || setting === 'max_charge_current' || 
              setting === 'max_grid_charge_current') {
        // Convert to input field for numeric values
        const rowElement = valueSelect.closest('.row');
        const colDiv = valueSelect.closest('.col-md-4');
        
        colDiv.innerHTML = `
            <label class="form-label">Value (A)</label>
            <input type="number" class="form-control action-value" min="0" max="100" step="0.1">
        `;
    } else if (setting === 'max_sell_power') {
        const rowElement = valueSelect.closest('.row');
        const colDiv = valueSelect.closest('.col-md-4');
        
        colDiv.innerHTML = `
            <label class="form-label">Value (W)</label>
            <input type="number" class="form-control action-value" min="0" max="10000" step="100">
        `;
    }
}

// Update the conditions array from UI
function updateConditionsFromUI() {
    conditions = [];
    
    document.querySelectorAll('.condition-card').forEach(card => {
        const parameter = card.querySelector('.condition-parameter').value;
        const operator = card.querySelector('.condition-operator').value;
        const value = parseFloat(card.querySelector('.condition-value').value);
        
        if (parameter && operator && !isNaN(value)) {
            conditions.push({ parameter, operator, value });
        }
    });
}

// Update the actions array from UI
function updateActionsFromUI() {
    actions = [];
    
    document.querySelectorAll('.action-card').forEach(card => {
        const setting = card.querySelector('.action-setting').value;
        const valueElement = card.querySelector('.action-value');
        let value;
        
        // Check if the value is a select or input
        if (valueElement.tagName === 'SELECT') {
            value = valueElement.value;
        } else {
            value = valueElement.value;
        }
        
        const inverter = card.querySelector('.action-inverter').value;
        
        if (setting && value && inverter) {
            actions.push({ setting, value, inverter });
        }
    });
}

// Update the rule preview
function updateRulePreview() {
    const name = document.getElementById('ruleName').value || 'Unnamed Rule';
    const description = document.getElementById('ruleDescription').value || 'No description';
    const active = document.getElementById('ruleActive').checked;
    
    updateConditionsFromUI();
    updateActionsFromUI();
    
    // Build the preview HTML
    let previewHTML = `
        <div class="preview-line"><strong>Name:</strong> ${name}</div>
        <div class="preview-line"><strong>Description:</strong> ${description}</div>
        <div class="preview-line"><strong>Active:</strong> ${active ? 'Yes' : 'No'}</div>
        <div class="preview-line"><strong>Conditions:</strong></div>
    `;
    
    if (conditions.length === 0) {
        previewHTML += `<div class="preview-line ms-3">No conditions (rule will always execute)</div>`;
    } else {
        conditions.forEach((condition, index) => {
            let parameterName = condition.parameter;
            let operatorSymbol = '';
            
            // Map parameters to human-readable names
            switch (condition.parameter) {
                case 'battery_soc': parameterName = 'Battery SOC'; break;
                case 'pv_power': parameterName = 'PV Power'; break;
                case 'load': parameterName = 'Load Power'; break;
                case 'grid_voltage': parameterName = 'Grid Voltage'; break;
                case 'grid_power': parameterName = 'Grid Power'; break;
                case 'battery_voltage': parameterName = 'Battery Voltage'; break;
                case 'battery_current': parameterName = 'Battery Current'; break;
            }
            
            // Map operators to symbols
            switch (condition.operator) {
                case 'gt': operatorSymbol = '>'; break;
                case 'lt': operatorSymbol = '<'; break;
                case 'eq': operatorSymbol = '='; break;
                case 'gte': operatorSymbol = '≥'; break;
                case 'lte': operatorSymbol = '≤'; break;
            }
            
            const logicalOperator = index === 0 ? 'If' : 'AND';
            
            // Add units based on parameter
            let unit = '';
            if (condition.parameter === 'battery_soc') unit = '%';
            else if (condition.parameter === 'pv_power' || condition.parameter === 'load' || condition.parameter === 'grid_power') unit = 'W';
            else if (condition.parameter === 'grid_voltage' || condition.parameter === 'battery_voltage') unit = 'V';
            else if (condition.parameter === 'battery_current') unit = 'A';
            
            previewHTML += `<div class="preview-line ms-3">${logicalOperator} ${parameterName} ${operatorSymbol} ${condition.value}${unit}</div>`;
        });
    }
    
    // Add time restrictions
    const timeRestrictionsEnabled = document.getElementById('enableTimeRestrictions').checked;
    if (timeRestrictionsEnabled) {
        previewHTML += `<div class="preview-line"><strong>Time Restrictions:</strong></div>`;
        
        // Add days
        const selectedDays = Array.from(document.querySelectorAll('input[name="days"]:checked'))
            .map(input => input.value.charAt(0).toUpperCase() + input.value.slice(1));
        
        previewHTML += `<div class="preview-line ms-3">Days: ${selectedDays.join(', ') || 'None'}</div>`;
        
        // Add time range
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        if (startTime && endTime) {
            previewHTML += `<div class="preview-line ms-3">Time: ${startTime} to ${endTime}</div>`;
        }
        
        // Add specific dates if enabled
        const specificDatesEnabled = document.getElementById('enableSpecificDates').checked;
        if (specificDatesEnabled && selectedDates.length > 0) {
            previewHTML += `<div class="preview-line ms-3">Specific Dates: ${selectedDates.join(', ')}</div>`;
        }
    }
    
    // Add actions
    previewHTML += `<div class="preview-line"><strong>Actions:</strong></div>`;
    
    if (actions.length === 0) {
        previewHTML += `<div class="preview-line ms-3">No actions defined</div>`;
    } else {
        actions.forEach((action, index) => {
            let settingName = action.setting;
            let valueDisplay = action.value;
            
            // Map settings to human-readable names
            switch (action.setting) {
                case 'grid_charge': settingName = 'Grid Charge'; break;
                case 'energy_pattern': settingName = 'Energy Pattern'; break;
                case 'work_mode': settingName = 'Work Mode'; break;
                case 'max_discharge_current': settingName = 'Max Discharge Current'; break;
                case 'max_charge_current': settingName = 'Max Charge Current'; break;
                case 'max_grid_charge_current': settingName = 'Max Grid Charge Current'; break;
                case 'solar_export_when_battery_full': settingName = 'Solar Export When Battery Full'; break;
                case 'max_sell_power': settingName = 'Max Sell Power'; break;
                case 'remote_switch': settingName = 'Remote Switch'; break;
                case 'generator_charge': settingName = 'Generator Charge'; break;
            }
            
            // Add units based on setting
            if (action.setting === 'max_discharge_current' || action.setting === 'max_charge_current' ||
                action.setting === 'max_grid_charge_current') {
                valueDisplay = `${action.value} A`;
            } else if (action.setting === 'max_sell_power') {
                valueDisplay = `${action.value} W`;
            }
            
            previewHTML += `<div class="preview-line ms-3">Set ${settingName} to ${valueDisplay} on ${action.inverter === 'all' ? 'All Inverters' : action.inverter.replace('_', ' ')}</div>`;
        });
    }
    
    document.getElementById('rulePreview').innerHTML = previewHTML;
}

// Update the selected dates UI
function updateSelectedDates() {
    const selectedDatesContainer = document.getElementById('selectedDates');
    const noDatesMessage = document.getElementById('noDatesMessage');
    
    if (selectedDates.length > 0) {
        noDatesMessage.style.display = 'none';
        
        // Clear and rebuild the dates display
        const existingTags = selectedDatesContainer.querySelectorAll('.date-tag');
        existingTags.forEach(tag => tag.remove());
        
        selectedDates.forEach(date => {
            const dateTag = document.createElement('span');
            dateTag.className = 'date-tag';
            dateTag.innerHTML = `${date} <span class="close" onclick="removeDate('${date}')">&times;</span>`;
            selectedDatesContainer.appendChild(dateTag);
        });
        
        // Update hidden input
        document.getElementById('calendarDates').value = JSON.stringify(selectedDates);
    } else {
        noDatesMessage.style.display = 'block';
        document.getElementById('calendarDates').value = '';
    }
}

// Remove a date from the selected dates
function removeDate(date) {
    selectedDates = selectedDates.filter(d => d !== date);
    updateSelectedDates();
}
function enhanceDaysOfWeekSelector() {
    // Find the days of week container
    const daysContainer = document.querySelector('.wizard-step#step3 .row:first-child .col-md-6 .d-flex.flex-wrap');
    
    if (!daysContainer) return;
    
    // Create new container with proper styling
    const newContainer = document.createElement('div');
    newContainer.className = 'days-of-week-container';
    
    // Get all existing checkboxes
    const existingCheckboxes = daysContainer.querySelectorAll('input[type="checkbox"]');
    
    // Days abbreviations
    const dayAbbreviations = {
        'monday': 'Mon',
        'tuesday': 'Tue',
        'wednesday': 'Wed',
        'thursday': 'Thu',
        'friday': 'Fri',
        'saturday': 'Sat',
        'sunday': 'Sun'
    };
    
    // For each day, create a new styled selector
    existingCheckboxes.forEach(checkbox => {
        const day = checkbox.value;
        const isChecked = checkbox.checked;
        const id = checkbox.id;
        
        // Create day selector element
        const daySelector = document.createElement('div');
        daySelector.className = 'day-selector';
        
        // Keep the original checkbox but make it invisible
        const newCheckbox = document.createElement('input');
        newCheckbox.type = 'checkbox';
        newCheckbox.id = id;
        newCheckbox.name = 'days';
        newCheckbox.value = day;
        newCheckbox.checked = isChecked;
        
        // Create the visual label
        const label = document.createElement('label');
        label.htmlFor = id;
        label.textContent = dayAbbreviations[day] || day.substring(0, 3);
        
        // Add elements to container
        daySelector.appendChild(newCheckbox);
        daySelector.appendChild(label);
        newContainer.appendChild(daySelector);
    });
    
    // Replace the old container with the new one
    daysContainer.parentNode.replaceChild(newContainer, daysContainer);
}

// Make sure to call this function after the document is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Call this after other initialization
    setTimeout(enhanceDaysOfWeekSelector, 100);
});

// Save the rule to the server
function saveRule() {
    // Update from UI
    updateConditionsFromUI();
    updateActionsFromUI();
    
    // Build the rule object
    const ruleName = document.getElementById('ruleName').value;
    const ruleDescription = document.getElementById('ruleDescription').value;
    const ruleActive = document.getElementById('ruleActive').checked;
    
    if (!ruleName) {
        alert('Please enter a rule name');
        return;
    }
    
    if (actions.length === 0) {
        alert('Please add at least one action');
        return;
    }
    
    // Build time restrictions
    const timeRestrictionsEnabled = document.getElementById('enableTimeRestrictions').checked;
    let timeRestrictions = {
        enabled: timeRestrictionsEnabled
    };
    
    if (timeRestrictionsEnabled) {
        // Get selected days
        const selectedDays = Array.from(document.querySelectorAll('input[name="days"]:checked'))
            .map(input => input.value);
        
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        timeRestrictions.days = selectedDays;
        timeRestrictions.startTime = startTime;
        timeRestrictions.endTime = endTime;
        
        // Add specific dates if enabled
        const specificDatesEnabled = document.getElementById('enableSpecificDates').checked;
        if (specificDatesEnabled) {
            timeRestrictions.specificDates = selectedDates;
        }
    }
    
    // Create the rule object
    const rule = {
        name: ruleName,
        description: ruleDescription,
        active: ruleActive,
        conditions: conditions,
        timeRestrictions: timeRestrictions,
        actions: actions
    };
    
    // Send to server
    fetch('/api/rules', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(rule)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Rule created successfully:', data);
        
        // Show success message
        const successMessage = document.querySelector('.success-message');
        successMessage.style.display = 'block';
        
        // Redirect after a short delay
        setTimeout(() => {
            window.location.href = '/rules';
        }, 2000);
    })
    .catch(error => {
        console.error('Error creating rule:', error);
        alert('Error creating rule: ' + error.message);
    });
}
</script>


</body>
</html>
